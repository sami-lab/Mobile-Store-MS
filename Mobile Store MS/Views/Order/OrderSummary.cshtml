@model Mobile_Store_MS.ViewModel.Orders.OrderViewModel
@using Mobile_Store_MS.Data
@using Microsoft.Extensions.Options
@inject IOptions<Mobile_Store_MS.Services.StripeSetting> Stripe
@inject SignInManager<ApplicationUser> signInManager
@{
    ViewData["Title"] = "Order Summary";
}

<div class="rounded border bg-white">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <div class="bg-light m-2 p-2">
        <h1 class="text-center mt-1 text-info">Summary</h1>
        <div class="row d-flex justify-content-around">
            <div class="col-md-5 col-lg-5 col-sm-12">
                <div class="form-group">
                    <label asp-for="cus_name" class="control-label"></label>
                    <input asp-for="cus_name" disabled class="form-control" />
                    <span asp-validation-for="cus_name" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="cus_phone" class="control-label"></label>
                    <input asp-for="cus_phone" disabled class="form-control" />
                    <span asp-validation-for="cus_phone" class="text-danger"></span>
                </div>

                @if (signInManager.IsSignedIn(User) && User.IsInRole("Admin") || User.IsInRole("Super Admin") || User.IsInRole("Employee"))
                {
                    <label class="border font-weight-bolder font-italic text-center mt-4 text-danger" style="font-family:'Times New Roman', Times, serif">If Customer already Purchase from Shop Just Write their RefNo# Otherwise Leave it Empty</label>
                    <div class="form-group">
                        <label asp-for="store_id" class="control-label col-6"></label>
                        <input asp-for="StoreName" disabled class="form-control" />
                        <span asp-validation-for="store_id" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="CustRef" class="control-label"></label>
                        <input asp-for="CustRef" disabled readonly min="1" class="form-control" />
                        <span asp-validation-for="CustRef" class="text-danger"></span>
                    </div>
                }
                else
                {
                    <div class="form-group">
                        <label asp-for="CityName" class="control-label ml-3"></label>
                        <input asp-for="CityName" disabled readonly class="form-control" />
                        <span asp-validation-for="CityId" class="text-danger"></span>
                    </div>
                    <div class="form-group row col-12">
                        <label asp-for="Address.StreetAddress" class="control-label"></label>
                        <textarea asp-for="Address.StreetAddress" disabled cols="4" rows="2" required placeholder="Street Adress" class="form-control w-100"></textarea>
                        <span asp-validation-for="Address.StreetAddress" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="store_id" class="control-label col-12"></label>
                        <input asp-for="StoreName" disabled class="form-control" />
                        <span asp-validation-for="store_id" class="text-danger"></span>
                    </div>


                    <input asp-for="CustRef" readonly min="1" hidden class="form-control disabled" />

                }


            </div>
            <div class="col-md-5 col-lg-5 col-sm-12">
                <div class="form-group ">
                    <label asp-for="com_Name" class="control-label col-6"></label>
                    <input asp-for="com_Name" disabled class="form-control" />
                    <span asp-validation-for="com_Name" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="model_name" class="control-label col-6"></label>
                    <input asp-for="model_name" disabled class="form-control" />
                    <span asp-validation-for="modelId" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Date" class="control-label"></label>
                    <input asp-for="Date" disabled value="@DateTime.Now.ToString("yyyy-MM-dd")" readonly class="form-control" />
                    <span asp-validation-for="Date" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Quantity" class="control-label"></label>
                    <input asp-for="Quantity" disabled min="1" class="form-control" />
                    <span asp-validation-for="Quantity" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Amount" class="control-label"></label>
                    <input id="price" asp-for="Amount" disabled readonly class="form-control" />
                    <span asp-validation-for="Amount" class="text-danger"></span>
                </div>
            </div>
        </div>

        @if (Model.Method == Mobile_Store_MS.ViewModel.Orders.PaymentMethods.Stripe)
        {
        <div>
            @{
                var OrderTotal = Model.Amount * 0.63;
            }


            <script  src="https://checkout.stripe.com/checkout.js" class="stripe-button" style="display:none"
                    data-key="@Stripe.Value.PublicKey"
                    data-amount="@OrderTotal"
                    data-name="Mobile Shop"
                    data-label="PLACE ORDER"
                    data-description="Be Smart with Smart Choice"
                    data-allow-remember-me="false"
                    data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
                    data-locale="auto">

            </script>
            <script type="text/javascript">
                //$('.stripe-button-el').addClass('d-none');
                $(document).ready(function () {
                    document.querySelector(".stripe-button-el")[0].style.display = "none";
                });               
            </script>
            <div class="form-group d-flex m-auto justify-content-end flex-row ">
                <button type="button" style="border-radius: 1.5rem;  margin-top: 1%; margin-right:2%; border: none;  padding:10px 2%; background: #0062cc; color: #fff; font-weight: 600;  cursor: pointer; width:20%; text-align:center;" data-dismiss="modal">Back</button>
                <input type="submit" value="Proceed To Checkout" style="border-radius: 1.5rem;  margin-right:8%; margin-top: 1%; border: none;  padding:10px 2%; background: #0062cc; color: #fff; font-weight: 600; width:20%; cursor: pointer;" />
            </div>
        </div>
        }
        else if (Model.Method == Mobile_Store_MS.ViewModel.Orders.PaymentMethods.CashOnDelievery)
        {
            <div class="form-group d-flex m-auto justify-content-end flex-row ">
                <button type="button" style="border-radius: 1.5rem;  margin-top: 1%; margin-right:2%; border: none;  padding:10px 2%; background: #0062cc; color: #fff; font-weight: 600;  cursor: pointer; width:20%; text-align:center;" data-dismiss="modal">Back</button>
                <input type="submit" value="Proceed To Checkout" style="border-radius: 1.5rem;  margin-right:8%; margin-top: 1%; border: none;  padding:10px 2%; background: #0062cc; color: #fff; font-weight: 600; width:40%; cursor: pointer;" />
            </div>
        }
        else
        {
            <script>
                $(':input[ type="submit"]').attr("disabled", true)
            </script>

        }
    </div>
   
</div>

